# AI 智慧旅遊行程規劃系統 - 專題文檔

## 目錄
1. [專題方法與系統開發相關技術](#1-專題方法與系統開發相關技術)
2. [已有成果](#2-已有成果)
3. [未來工作](#3-未來工作)

---

## 1. 專題方法與系統開發相關技術

### 1.1 系統架構圖

```
┌─────────────────────────────────────────────────────────────────┐
│                         使用者介面層 (Frontend)                    │
├─────────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   React 19   │  │ React Router │  │ Vite 7.1.9   │          │
│  │              │  │      v6      │  │ (Build Tool) │          │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘          │
│         │                  │                  │                   │
│  ┌──────┴──────────────────┴──────────────────┴───────┐          │
│  │           UI 框架與工具                              │          │
│  │  • Tailwind CSS v4 (CDN) - 樣式設計                │          │
│  │  • Font Awesome - 圖標                             │          │
│  │  • Google Fonts (Poppins, Playfair Display)       │          │
│  └────────────────────────────────────────────────────┘          │
│                                                                   │
│  頁面組件:                                                        │
│  ├─ HomePage (首頁/Landing Page)                                │
│  ├─ PlannerPage (行程規劃頁面)                                   │
│  ├─ Header (導航欄)                                              │
│  ├─ TripResults (行程結果展示)                                   │
│  ├─ AuthForm (登入/註冊表單)                                     │
│  ├─ ProfileEditor (個人資料編輯)                                 │
│  └─ WeatherCard (天氣卡片)                                       │
└─────────────────────────────────────────────────────────────────┘
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      API 層 (Backend/Serverless)                 │
├─────────────────────────────────────────────────────────────────┤
│  ┌────────────────────────────────────────────────────┐          │
│  │              Vercel Serverless Functions            │          │
│  └────────────────────────────────────────────────────┘          │
│         │                                                         │
│  ┌──────┴────────┐  ┌────────────┐  ┌────────────────┐         │
│  │  /api/ask.js  │  │  工具函數  │  │   RAG 系統     │         │
│  │  (主要 API)   │  │  _utils.js │  │  ragRetriever  │         │
│  └───────────────┘  └────────────┘  └────────────────┘         │
│                                                                   │
│  功能模組:                                                        │
│  ├─ 串流式回應處理 (SSE - Server-Sent Events)                   │
│  ├─ 問題解析與意圖識別                                           │
│  ├─ 天氣資料獲取                                                 │
│  ├─ 地理位置優化 (geoOptimizer)                                 │
│  └─ AI 行程生成                                                  │
└─────────────────────────────────────────────────────────────────┘
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                         AI 服務層                                 │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────┐                    │
│  │         OpenAI GPT-4 / GPT-3.5          │                    │
│  │  • 自然語言理解 (NLU)                   │                    │
│  │  • 旅遊行程生成                         │                    │
│  │  • 結構化輸出 (JSON Mode)               │                    │
│  └─────────────────────────────────────────┘                    │
│                                                                   │
│  ┌─────────────────────────────────────────┐                    │
│  │      RAG (Retrieval-Augmented Generation) │                  │
│  │  • 向量資料庫檢索                       │                    │
│  │  • 景點/餐廳資料庫查詢                  │                    │
│  │  • 上下文增強生成                       │                    │
│  └─────────────────────────────────────────┘                    │
└─────────────────────────────────────────────────────────────────┘
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      資料儲存層 (Database)                        │
├─────────────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────┐                   │
│  │           Supabase (PostgreSQL)          │                   │
│  │  • 使用者認證系統 (Auth)                 │                   │
│  │  • 使用者資料儲存                        │                   │
│  │  • 景點資料表 (attractions)              │                   │
│  │  • 餐廳資料表 (restaurants)              │                   │
│  │  • 向量搜尋功能 (pgvector extension)     │                   │
│  └──────────────────────────────────────────┘                   │
│                                                                   │
│  認證方式:                                                        │
│  ├─ Email/Password 登入                                         │
│  └─ Google OAuth 2.0 登入                                       │
└─────────────────────────────────────────────────────────────────┘
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      外部 API 整合層                              │
├─────────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │  天氣 API    │  │  地圖 API    │  │  其他服務    │          │
│  │  (Weather)   │  │  (Maps)      │  │              │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
└─────────────────────────────────────────────────────────────────┘
```

### 1.2 核心技術棧

#### 前端技術
| 技術 | 版本 | 用途 |
|------|------|------|
| React | 19.1.1 | UI 框架，構建互動式使用者介面 |
| Vite | 7.1.9 | 快速開發伺服器與建置工具 |
| React Router DOM | 6.x | 單頁應用路由管理 |
| Tailwind CSS | v4 (CDN) | 實用優先的 CSS 框架 |
| Supabase Client | Latest | 前端認證與資料庫客戶端 |

#### 後端技術
| 技術 | 用途 |
|------|------|
| Vercel Serverless Functions | 無伺服器 API 端點 |
| Node.js | JavaScript 運行環境 |
| Server-Sent Events (SSE) | 即時串流資料傳輸 |
| OpenAI API | AI 文字生成與理解 |

#### 資料庫與認證
| 技術 | 用途 |
|------|------|
| Supabase (PostgreSQL) | 主資料庫與向量資料庫 |
| pgvector | 向量相似度搜尋擴充功能 |
| Supabase Auth | 使用者認證系統 |

### 1.3 系統工作流程

```
使用者輸入旅遊需求
        ↓
前端驗證與格式化
        ↓
發送 POST 請求到 /api/ask
        ↓
┌───────────────────────────────┐
│   後端處理流程 (串流式)        │
├───────────────────────────────┤
│ 1. 解析使用者問題             │
│    • 提取地點、天數、偏好     │
│    ↓                          │
│ 2. 獲取天氣資料               │
│    • SSE Event: weather       │
│    ↓                          │
│ 3. RAG 資料庫查詢 (可選)      │
│    • 查詢相關景點/餐廳        │
│    • 向量相似度搜尋           │
│    ↓                          │
│ 4. AI 行程生成                │
│    • 呼叫 OpenAI API          │
│    • SSE Event: generation    │
│    ↓                          │
│ 5. 回傳結構化行程             │
│    • SSE Event: result        │
└───────────────────────────────┘
        ↓
前端接收並解析 SSE 事件
        ↓
即時更新 UI 狀態
        ↓
展示完整行程結果
```

### 1.4 關鍵技術特點

#### 1.4.1 串流式回應 (Server-Sent Events)
- **優點**: 即時反饋、降低等待焦慮、提升使用者體驗
- **實作**: 
  ```javascript
  event: parsing
  data: {"location": "京都", "days": 5}
  
  event: weather
  data: {"temperature": 25, "condition": "sunny"}
  
  event: generation
  data: {"status": "generating"}
  
  event: result
  data: {"itinerary": {...}}
  ```

#### 1.4.2 RAG (檢索增強生成)
- **原理**: 結合向量資料庫檢索與 AI 生成
- **優勢**: 
  - 提供真實、最新的景點資訊
  - 減少 AI 幻覺 (hallucination)
  - 提高行程可靠性

#### 1.4.3 響應式設計
- **Mobile First**: 優先考慮移動裝置體驗
- **Tailwind CSS**: 快速實現響應式布局
- **動畫效果**: Intersection Observer + CSS animations

#### 1.4.4 使用者認證系統
- **多重登入方式**: Email/Password, Google OAuth
- **Session 管理**: Supabase Auth 自動處理
- **個人資料管理**: 可編輯顯示名稱與偏好設定

---

## 2. 已有成果

### 2.1 前端介面 ✅

#### 2.1.1 首頁 (HomePage)
- ✅ **視覺設計**: 完全複製 stitch_ai 模板設計
  - 全螢幕影片背景 (Pixabay 旅遊影片)
  - 透明懸浮導航列
  - 大型標題與 CTA 按鈕
  - 滾動向下提示動畫
  
- ✅ **功能特色區塊**:
  - 水平排列三個特色卡片
  - 圖標 + 標題 + 描述
  - 滾動觸發淡入動畫 (IntersectionObserver)

- ✅ **配色與字體**:
  - 主色: #13a4ec (天藍色)
  - 字體: Poppins (無襯線), Playfair Display (襯線)
  - 一致的圓角與陰影設計

#### 2.1.2 規劃頁面 (PlannerPage)
- ✅ **雙欄式布局**:
  - 左側: 輸入表單 (2/3 寬度)
  - 右側: 規劃提示卡片 (1/3 寬度)

- ✅ **智慧輸入框**:
  - 大型文字區域 (14 行高度)
  - 範例提示語快速填入
  - 即時狀態反饋
  - 禁用狀態處理

- ✅ **串流狀態顯示**:
  - 正在解析問題...
  - 正在獲取天氣資訊...
  - AI 正在生成行程...
  - 行程規劃完成！

#### 2.1.3 導航列 (Header)
- ✅ **智慧樣式切換**:
  - 首頁: 透明背景 + 白色文字 + 絕對定位
  - 其他頁面: 白色背景 + 深色文字 + 陰影

- ✅ **使用者功能**:
  - 未登入: Log in / Sign up 按鈕
  - 已登入: 顯示使用者名稱 + 登出按鈕
  - 個人資料編輯入口

#### 2.1.4 認證系統
- ✅ **登入/註冊表單** (AuthForm):
  - Email/Password 登入
  - Google OAuth 登入
  - 表單驗證與錯誤提示
  - Modal 彈窗設計

- ✅ **個人資料編輯** (ProfileEditor):
  - 修改顯示名稱
  - 顯示 Email (不可編輯)
  - 即時更新 Session

### 2.2 後端 API ✅

#### 2.2.1 主要端點: `/api/ask`
- ✅ **支援功能**:
  - 接收使用者問題
  - Session ID 管理
  - RAG 開關控制 (useRAG 參數)

- ✅ **串流式回應**:
  ```javascript
  POST /api/ask
  Content-Type: application/json
  
  {
    "session_id": "session-1729123456789",
    "question": "我想去京都玩5天",
    "useRAG": true
  }
  
  // Response (SSE Stream)
  event: parsing
  data: {"data": {"location": "京都", "days": 5, "dates": ["2025-10-20"]}}
  
  event: weather
  data: {"status": "fetching"}
  
  event: weather
  data: {"data": {"temperature": 25, "condition": "晴天"}}
  
  event: generation
  data: {"status": "generating"}
  
  event: result
  data: {"data": {"itinerary": [...], "summary": "..."}}
  ```

#### 2.2.2 工具模組
- ✅ **`ragRetriever.js`**: 
  - 向量資料庫查詢
  - 景點/餐廳檢索
  - 相似度排序

- ✅ **`geoOptimizer.js`**:
  - 地理位置優化
  - 路線規劃輔助

- ✅ **`_utils.js`**:
  - 共用工具函數
  - 錯誤處理
  - 日期格式化

### 2.3 資料庫與認證 ✅

#### 2.3.1 Supabase 設定
- ✅ **資料表結構**:
  - `attractions`: 景點資料 (含向量欄位)
  - `restaurants`: 餐廳資料
  - `auth.users`: 使用者帳號 (Supabase 內建)

- ✅ **向量搜尋**:
  - pgvector 擴充功能已啟用
  - 自訂搜尋函數 (SQL Function)
  - 語義相似度匹配

#### 2.3.2 認證系統
- ✅ **多重登入方式**:
  - Email/Password
  - Google OAuth 2.0

- ✅ **Session 管理**:
  - 自動刷新 Token
  - 持久化登入狀態
  - 安全登出機制

### 2.4 部署與環境 ✅

#### 2.4.1 開發環境
- ✅ **本地開發伺服器**:
  - Frontend: `npm run dev` (Port 5174)
  - Backend: Node.js API 伺服器 (Port 3000)

- ✅ **環境變數管理**:
  - `.env.local`: Supabase 憑證
  - OpenAI API Key
  - 其他敏感資訊

#### 2.4.2 生產環境
- ✅ **Vercel 部署配置**:
  - `vercel.json`: 路由與重寫規則
  - Serverless Functions 自動部署
  - 環境變數設定

### 2.5 使用者體驗優化 ✅

- ✅ **載入狀態**: Spinner + 狀態文字
- ✅ **錯誤處理**: 友善的錯誤訊息
- ✅ **響應式設計**: 支援桌面/平板/手機
- ✅ **動畫效果**: 
  - fadeInUp 動畫
  - 滾動觸發動畫
  - Hover 效果
- ✅ **無障礙設計**: 
  - 語義化 HTML
  - ARIA 標籤
  - 鍵盤導航支援

---

## 3. 未來工作

### 3.1 行程結果展示優化 🚧

#### 3.1.1 日程標籤頁系統
**參考**: stitch_ai 行程詳情頁面

**規劃功能**:
- [ ] **多日標籤切換**:
  ```
  ┌─────┬─────┬─────┬─────┬─────┐
  │Day 1│Day 2│Day 3│Day 4│Day 5│
  └─────┴─────┴─────┴─────┴─────┘
  ```
  - 點擊切換不同天數的行程
  - 當前選中日期高亮顯示
  - 平滑過渡動畫

- [ ] **日期顯示增強**:
  - 顯示具體日期 (如: 10月20日 週一)
  - 天氣圖標與溫度
  - 日出/日落時間

#### 3.1.2 時間軸視圖
**視覺設計**:
```
09:00 ─┬─ 🏛️ 清水寺
       │   參觀時間: 1.5小時
       │   門票: ¥400
       │   
11:00 ─┼─ 🍜 午餐 - 錦市場
       │   預算: ¥1500
       │   
14:00 ─┼─ 🏯 金閣寺
       │   參觀時間: 1小時
       │   
17:00 ─┼─ 🌸 嵐山竹林
       │   建議停留: 2小時
       │
19:00 ─┴─ 🍱 晚餐 - 先斗町
```

**功能需求**:
- [ ] 垂直時間軸設計
- [ ] 時間點標記
- [ ] 景點圖標與名稱
- [ ] 預估時間與費用
- [ ] 互動式地圖標記

#### 3.1.3 行程卡片設計
- [ ] **資訊完整性**:
  - 景點名稱與類型
  - 地址與交通方式
  - 營業時間
  - 門票價格
  - 推薦原因
  - 使用者評分 (如果有)

- [ ] **互動功能**:
  - 點擊展開詳細資訊
  - 加入收藏 / 移除項目
  - 調整順序 (拖拉排序)
  - 分享單日行程

- [ ] **視覺優化**:
  - 高品質景點圖片
  - 漸層背景卡片
  - 標籤分類 (美食/景點/住宿)
  - 響應式圖片載入

### 3.2 進階功能開發 🔮

#### 3.2.1 行程管理系統
- [ ] **儲存與載入**:
  - 儲存行程到資料庫
  - 我的行程列表頁面
  - 編輯已儲存的行程
  - 複製與修改行程

- [ ] **分享功能**:
  - 生成分享連結
  - 社群媒體分享按鈕
  - 匯出 PDF 格式
  - 匯出日曆事件 (.ics)

#### 3.2.2 協作功能
- [ ] **多人規劃**:
  - 邀請好友共同編輯
  - 即時協作更新
  - 評論與建議系統
  - 投票決定行程

#### 3.2.3 預算管理
- [ ] **費用追蹤**:
  - 各項目預算輸入
  - 總費用計算與圖表
  - 類別分類 (交通/住宿/餐飲/門票)
  - 幣別轉換

- [ ] **省錢建議**:
  - 推薦經濟方案
  - 優惠券與折扣資訊
  - 淡旺季價格提示

#### 3.2.4 互動式地圖
- [ ] **Google Maps 整合**:
  - 標記所有景點位置
  - 路線規劃與導航
  - 交通時間估算
  - 附近推薦 (Nearby Search)

- [ ] **地圖視覺化**:
  - 每日路線顯示
  - 集群標記 (Clustering)
  - 自訂圖標樣式
  - 街景預覽

### 3.3 AI 功能增強 🤖

#### 3.3.1 個人化推薦
- [ ] **使用者偏好學習**:
  - 記錄瀏覽歷史
  - 分析興趣標籤
  - 推薦相似景點
  - 個人化行程建議

- [ ] **問答系統**:
  - 行程相關 Q&A
  - 旅遊攻略諮詢
  - 即時聊天機器人

#### 3.3.2 智慧優化
- [ ] **行程自動優化**:
  - 路線順序最佳化 (TSP 問題)
  - 避免擁擠時段
  - 考慮休息時間
  - 天氣影響調整

- [ ] **替代方案**:
  - 雨天備案
  - 景點閉館應對
  - 交通延誤調整

#### 3.3.3 RAG 系統強化
- [ ] **資料庫擴充**:
  - 更多城市與景點
  - 餐廳詳細資訊
  - 住宿推薦資料
  - 當地活動與節慶

- [ ] **檢索優化**:
  - 多模態檢索 (文字+圖片)
  - 混合搜尋 (向量+關鍵字)
  - 重排序演算法 (Reranking)

### 3.4 效能與品質提升 ⚡

#### 3.4.1 前端優化
- [ ] **效能提升**:
  - 程式碼分割 (Code Splitting)
  - 懶載入 (Lazy Loading)
  - 圖片最佳化 (WebP)
  - Service Worker (PWA)

- [ ] **快取策略**:
  - API 回應快取
  - 靜態資源 CDN
  - 離線支援

#### 3.4.2 後端優化
- [ ] **API 效能**:
  - Redis 快取層
  - 資料庫查詢優化
  - 併發請求處理
  - Rate Limiting

- [ ] **可靠性**:
  - 錯誤監控 (Sentry)
  - 日誌系統
  - 健康檢查端點
  - 自動重試機制

#### 3.4.3 測試與 QA
- [ ] **單元測試**:
  - React 組件測試 (Vitest)
  - API 端點測試
  - 工具函數測試

- [ ] **整合測試**:
  - E2E 測試 (Playwright)
  - 使用者流程測試
  - 跨瀏覽器測試

- [ ] **效能測試**:
  - Lighthouse 評分優化
  - Core Web Vitals 監控
  - 載入時間分析

### 3.5 使用者體驗優化 ✨

#### 3.5.1 多語言支援
- [ ] **國際化 (i18n)**:
  - 英文版本
  - 日文版本
  - 其他語言
  - 自動語言偵測

#### 3.5.2 無障礙增強
- [ ] **WCAG 2.1 合規**:
  - 螢幕閱讀器支援
  - 鍵盤完整導航
  - 對比度檢查
  - 焦點管理

#### 3.5.3 互動體驗
- [ ] **微互動設計**:
  - 按鈕點擊回饋
  - 頁面切換動畫
  - 骨架屏 (Skeleton Screen)
  - Toast 通知系統

- [ ] **引導教學**:
  - 首次使用導覽
  - 功能提示氣泡
  - 互動式教學

### 3.6 商業功能 💼

#### 3.6.1 付費功能
- [ ] **進階功能訂閱**:
  - 無限儲存行程
  - AI 深度優化
  - 優先客服支援
  - 無廣告體驗

#### 3.6.2 合作夥伴整合
- [ ] **第三方服務**:
  - 飯店預訂 (Booking.com, Agoda)
  - 機票搜尋 (Skyscanner)
  - 租車服務
  - 當地體驗 (Klook, KKday)

#### 3.6.3 數據分析
- [ ] **使用者行為追蹤**:
  - Google Analytics 4
  - 熱力圖分析 (Hotjar)
  - 轉換率優化
  - A/B 測試

---

## 附錄

### A. 專案結構
```
AI_website/
├── react-app/                    # 前端應用
│   ├── src/
│   │   ├── pages/                # 頁面組件
│   │   │   ├── HomePage.jsx      # 首頁
│   │   │   └── PlannerPage.jsx   # 規劃頁面
│   │   ├── components/           # 可重用組件
│   │   │   ├── Header.jsx        # 導航列
│   │   │   ├── AuthForm.jsx      # 認證表單
│   │   │   ├── ProfileEditor.jsx # 個人資料編輯
│   │   │   ├── TripResults.jsx   # 行程結果
│   │   │   └── WeatherCard.jsx   # 天氣卡片
│   │   ├── App.jsx               # 主應用組件
│   │   ├── main.jsx              # 應用入口
│   │   ├── index.css             # 全域樣式
│   │   └── supabaseClient.js     # Supabase 客戶端
│   ├── public/                   # 靜態資源
│   ├── index.html                # HTML 模板
│   ├── package.json              # 依賴管理
│   └── vite.config.js            # Vite 配置
├── api/                          # 後端 API
│   ├── ask.js                    # 主要 API 端點
│   ├── _utils.js                 # 工具函數
│   └── utils/
│       ├── ragRetriever.js       # RAG 檢索器
│       └── geoOptimizer.js       # 地理優化器
├── data/                         # 原始資料
│   ├── all_spot.csv              # 景點資料
│   └── allRestaurant.csv         # 餐廳資料
├── supabase/                     # 資料庫 SQL
│   ├── 01_enable_extensions.sql  # 擴充功能
│   ├── 02_create_attractions_table.sql
│   ├── 03_create_search_function.sql
│   └── 04_remove_google_fields.sql
└── scripts/                      # 工具腳本
    └── import_data_to_supabase.js
```

### B. 技術決策記錄

#### B.1 為什麼選擇 React?
- **優點**: 
  - 組件化開發
  - 龐大的生態系統
  - 優秀的開發者體驗
  - React 19 的最新特性

#### B.2 為什麼使用 Tailwind CSS CDN?
- **原因**: 
  - 與參考模板 (stitch_ai) 配置一致
  - 快速開發與原型設計
  - 無需複雜的建置配置
  - 動態類別支援

#### B.3 為什麼選擇 Vercel Serverless?
- **優勢**:
  - 零配置部署
  - 自動擴展
  - 全球 CDN
  - 與 Next.js/React 生態整合良好

#### B.4 為什麼使用 Supabase?
- **原因**:
  - 開源 Firebase 替代方案
  - PostgreSQL 強大功能
  - 內建認證系統
  - 向量搜尋支援 (pgvector)

### C. 參考資源

- **設計參考**: stitch_ai 模板
- **React 文檔**: https://react.dev
- **Tailwind CSS**: https://tailwindcss.com
- **Supabase 文檔**: https://supabase.com/docs
- **OpenAI API**: https://platform.openai.com/docs
- **Vercel 文檔**: https://vercel.com/docs

---

**文檔版本**: v1.0  
**最後更新**: 2025-10-19  
**維護者**: 專題團隊
